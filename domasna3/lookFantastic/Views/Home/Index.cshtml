@model lookFantastic.Models.Location
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <style>
        body {
            font-family: "Work Sanse",sans-serif;
        }
        .location {
            z-index: 1000;
            position: absolute;
            margin-top: 100px;
            right: -130px;
            font-size: 13px;
            padding-left: 8px;
            font-family: "Work Sans",sans-serif;
        }

        #loc {
            text-decoration: none;
            color: black;
            border: 1px solid black;
            width: 150px;
            color: black;
            background-color: white;
            opacity: 0.6;
        }

        #map {
            position: fixed;
            padding: 0;
            margin: 0;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .navlist {
            display: inline-flex;
            float: right;
            list-style: none;
            margin-right: 200px;
            text-align: center;
        }

            .navlist li {
                padding-right: 80px;
                padding-top: 7px;
                height: 100%;
            }

                .navlist li:hover {
                    background-color: #F7E3DE;
                    transition: .2s;
                }

                .navlist li a {
                    color: black;
                    text-decoration: none;
                }

        .nav {
            border-bottom: 1px solid black;
            border-top: 1px solid black;
            width: 100%;
            margin-top: 120px;
            background-color: white;
        }

        .shadow {
            width: 100%;
            height: 100%;
            position: fixed;
            background-color: black;
            top: 0;
            left: 0;
            z-index: 400;
        }

        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            font-family: "Work sans",sans-serif;
            background-color: white;
            z-index: 10;
        }

        .submenu {
            position: absolute;
            margin-right: 15px;
            list-style: none;
            border: 1px solid #f7a193;
            display: none;
        }

        .line {
            border-top: 1px solid black;
            margin-top: 35px;
            background-color: white;
        }

        .loginLabel {
            float: right;
            margin-top: 45px;
            margin-right: 70px;
            font-size: 16px;
        }

        .container {
            position: relative;
            top: 100px;
        }

        .subList {
            list-style: none;
            display: inline-flex;
        }

       
            .dialog{
                z-index:20;
                width:300px;
                height:400px;
                background-color:white;
                opacity:0.8;
                border:1px solid black;
                position:absolute;
                margin-top:230px;
                left:-20px;
            }
            .label{
                font-weight:400;
            }
    </style>
</head>
<body>
    <div class=" navbar">
        <div class="navbardef">
            <div class="line">
                <img style="width:180px;height:180px;position:absolute;top:15px;" src="~/logo_transparent.png" />
                <div class="loginLabel">
                    <div>
                        <img style="width:20px;height:20px;position:absolute;right:170px;" src="https://www.pngitem.com/pimgs/m/150-1503941_user-windows-10-user-icon-png-transparent-png.png" />
                    </div>
                    <a style="text-decoration:none;color:black;" href="#">
                        My Account
                        <ul class="submenu">
                            <li>List 1</li>
                            <li>List 2</li>
                        </ul>
                    </a>
                </div>
            </div>
            <div class="nav">
                <ul class="navlist">
                    <ul class="navlist">
                        <li>@Html.ActionLink("Home", "Index", "Home")</li>
                        <li>
                            @Html.ActionLink("Hairdressers", "Index", "Hairdressers")
                            <ul id="sub" class="submenu">
                                <li>Male</li>
                                <li>Female</li>
                            </ul>
                        </li>
                        <li style="">@Html.ActionLink("Beauty Salons", "Index", "BeautySalons")</li>
                        <li>@Html.ActionLink("Clothing Shops", "Index", "ClothingShops")</li>
                        <li>@Html.ActionLink("Fitness Centers", "Index", "FitnessCentres")</li>
                    </ul>
                </ul>
            </div>
        </div>
    </div>
    <div class="location" style="">
        <button id="loc" href="" style="">Show my location</button>
    </div>
    <div class="dialog">
        <div class="dialogContent" style="position:relative;">

            <div class="dropdownList2" style="text-align:center;margin-top:50px;">
                <input style="width:200px;" type="text" id="nameSearch" placeholder="Search by name" />
            </div>
            <div class="dropdownList3" style="text-align:center;margin-top:50px;">
                <select style="width:200px;" id="dropL">
                    <option value="" selected disabled hidden>Search by review</option>
                    <option value="5">*****</option>
                    <option value="4">****</option>
                    <option value="3">***</option>
                    <option value="2">**</option>
                    <option value="1">*</option>
                </select>
            </div>
        </div>
    </div>
    <div>
        <form>
            <div class="form-check" style="z-index: 600;position:absolute;top:450px;display:grid;">
                <input type="checkbox" class="form-check-input" id="Berberi" value="berberi" name="filtriranje1">
                <label class="form-check-label" for="Berberi" style="font-weight:400">Hairdressers</label>
                <input type="checkbox" class="form-check-input" id="Teretani" value="teretani" name="filtriranje2">
                <label class="form-check-label" for="Teretani" style="font-weight:400">Fitness Centres</label>
                <input type="checkbox" class="form-check-input" id="SaloniZaUbavina" value="salonizaubavina" name="filtriranje3">
                <label class="form-check-label" for="SaloniZaUbavina" style="font-weight:400">Beauty Salons</label>
                <input type="checkbox" class="form-check-input" id="Butici" value="butici" name="filtriranje4">
                <label class="form-check-label" for="Butici" style="font-weight:400">Clothing Shops</label>
            </div>
        </form>
    </div>
    <div id="map"></div>
    @section scripts{
        <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
        <script src="~/Scripts/jquery-3.4.1.js"></script>
        <script>

            var map = L.map('map').setView({ lon: 2.5749, lat: 48.8358 }, 10);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '&copy; <a href="https://openstreetmap.org/copyright">OpenStreetMap contributors</a>'
            }).addTo(map);

            L.control.scale().addTo(map);

            var markBerberi = function () {
                var tmp = null;
                $.ajax({
                    'async': false,
                    type: "GET",
                    url: "/api/Hairdressers/",
                    data: "{}",
                    success: function (data) {
                        tmp = data;

                    }
                });
                return tmp;
            }();


            var markeriBerberi = [];
            for (var i = 0; i < 100; i++) {
                var LamMarker = new L.marker([markBerberi[i].lat, markBerberi[i].lon]).bindPopup(markBerberi[i].name).openPopup();
                markeriBerberi.push(LamMarker);
            }
            $("#Berberi").change(function () {
                if (this.checked) {
                    for (var i = 0; i < 100; i++) {

                        map.addLayer(markeriBerberi[i]);
                    }
                }
                else {
                    for (var i = 0; i < 100; i++) {
                        map.removeLayer(markeriBerberi[i]);
                    }
                }
            });

            var markTeretani = function () {
                var tmp = null;
                $.ajax({
                    'async': false,
                    type: "GET",
                    url: "/api/FitnessCentres/",
                    data: "{}",
                    success: function (data) {
                        tmp = data;

                    }
                });
                return tmp;
            }();
            var markeriTeretani = [];
            for (var i = 0; i < 100; i++) {
                var LamMarker = new L.marker([markTeretani[i].lat, markTeretani[i].lon]).bindPopup(markTeretani[i].name).openPopup();
                markeriTeretani.push(LamMarker);
            }
            $("#Teretani").change(function () {
                if (this.checked) {
                    for (var i = 0; i < 100; i++) {

                        map.addLayer(markeriTeretani[i]);
                    }
                }
                else {
                    for (var i = 0; i < 100; i++) {
                        map.removeLayer(markeriTeretani[i]);
                    }
                }
            });


            var markSaloni = function () {
                var tmp = null;
                $.ajax({
                    'async': false,
                    type: "GET",
                    url: "/api/BeautySalons/",
                    data: "{}",
                    success: function (data) {
                        tmp = data;

                    }
                });
                return tmp;
            }();
            var markeriSaloni = [];
            for (var i = 0; i < 100; i++) {
                var LamMarker = new L.marker([markSaloni[i].lat, markSaloni[i].lon]).bindPopup(markSaloni[i].name).openPopup();
                markeriSaloni.push(LamMarker);
            }
            $("#SaloniZaUbavina").change(function () {
                if (this.checked) {
                    for (var i = 0; i < 100; i++) {

                        map.addLayer(markeriSaloni[i]);
                    }
                }
                else {
                    for (var i = 0; i < 100; i++) {
                        map.removeLayer(markeriSaloni[i]);
                    }
                }
            });


            var markButici = function () {
                var tmp = null;
                $.ajax({
                    'async': false,
                    type: "GET",
                    url: "/api/ClothingShops/",
                    data: "{}",
                    success: function (data) {
                        tmp = data;

                    }
                });
                return tmp;
            }();
            var markeriButici = [];
            for (var i = 0; i < 100; i++) {
                var LamMarker = new L.marker([markButici[i].lat, markButici[i].lon]).bindPopup(markButici[i].name).openPopup();
                markeriButici.push(LamMarker);
            }
            $("#Butici").change(function () {
                if (this.checked) {
                    for (var i = 0; i < 100; i++) {

                        map.addLayer(markeriButici[i]);
                    }
                }
                else {
                    for (var i = 0; i < 100; i++) {
                        map.removeLayer(markeriButici[i]);
                    }
                }
            });
            var sveLokacije = markBerberi.concat(markButici, markSaloni, markTeretani);
            var markerIme = [];
            $('#nameSearch').keyup(function (e) {
                if (typeof markerIme != 'undefined') {
                    for (var i = 0; i < markerIme.length; i++) {
                        map.removeLayer(markerIme[i]);
                    }
                    markerIme = [];
                }
                var ime = $('#nameSearch').val();
                console.log(ime);
                for (var i = 0; i < sveLokacije.length; i++) {
                    if (sveLokacije[i].name === ime) {
                        var markerI = new L.marker([sveLokacije[i].lat, sveLokacije[i].lon]).bindPopup(sveLokacije[i].name).openPopup();
                        markerIme.push(markerI);
                        map.addLayer(markerI);
                    }

                }

            });
            var markerOcena = [];
            $("#dropL").change(function () {
                if (typeof markerOcena != 'undefined') {
                    for (var i = 0; i < markerOcena.length; i++) {
                        map.removeLayer(markerOcena[i]);
                    }
                    markerOcena = [];
                }
                var ocena = $('#dropL option:selected').val();
                if (ocena === 1) {
                    for (var i = 0; i < sveLokacije.length; i++) {
                        if (sveLokacije[i].averagegrade === 0) {
                            var markerI = new L.marker([sveLokacije[i].lat, sveLokacije[i].lon]).bindPopup(sveLokacije[i].name).openPopup();
                            markerOcena.push(markerI);
                            map.addLayer(markerI);
                        }
                    }
                }
                for (var i = 0; i < sveLokacije.length; i++) {
                    if (sveLokacije[i].averagegrade > ocena - 1 && sveLokacije[i].averagegrade <= ocena) {
                        var markerI = new L.marker([sveLokacije[i].lat, sveLokacije[i].lon]).bindPopup(sveLokacije[i].name).openPopup();
                        markerOcena.push(markerI);
                        map.addLayer(markerI);
                    }

                }
            });
            $("#loc").on("click", function () {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(function (position) {
                        latit = position.coords.latitude;
                        console.log(latit);
                        longit = position.coords.longitude;
                        console.log(longit);
                        var abc = L.marker([position.coords.latitude, position.coords.longitude]).addTo(map);
                        map.panTo(new L.LatLng(latit, longit));
                    });
                }
            });
        </script>
    }
</body>
</html>
